<dialog [open]="opened" cdkTrapFocus>
  <div
    class="settings-dialog"
    [@open]="openedAnimation"
    [@bounce]="animationState"
    (@bounce.done)="animationState = false"
  >
    <div class="settings-menu">
      <nav
        tabindex="0"
        (keydown.enter)="navigate(focusedItem ?? 0)"
        (keydown.space)="navigate(focusedItem ?? 0)"
        (keydown.arrowDown)="focusNext()"
        (keydown.arrowUp)="focusPrev()"
        (mousedown)="mouseDown = true"
        (mouseup)="mouseDown = false"
        (focusin)="menuFocused = !mouseDown"
        (focusout)="menuFocused = false"
      >
        <div
          *ngFor="let item of items; let i = index"
          [class.item]="item.type === 'item'"
          [class.active]="i === defaultPage"
          [class.focus]="i === focusedItem && menuFocused"
          [class.category]="item.type === 'category'"
          [class.divider]="item.type === 'divider'"
          [class.red]="item.critical"
          (click)="navigate(i); menuFocused = false"
        >
          {{ item.name ? (item.name | translate) : '' }}
        </div>
      </nav>
    </div>
    <div class="settings-right">
      <div class="settings-content">
        <ng-template [cdkPortalOutlet]="portal" (attached)="attached($event)"></ng-template>
      </div>

      <div class="settings-close-anchor">
        <div class="settings-close" (click)="close()">
          <xui-icon tabindex="0" (keydown.space)="close()" (keydown.enter)="close()">close-circle-outline</xui-icon>
          ESC
        </div>
      </div>
    </div>
  </div>
</dialog>
